name: Start mirakc

on:
  push:
    branches:
    - main
    paths:
    - 'mirakc/**'
  workflow_dispatch:
    inputs:
      rm_state:
        description: 'inject docker compose down'
        type: boolean
        default: false

jobs:
  setup:
    runs-on: [self-hosted, mirakc]
    defaults:
      run:
        working-directory: ./mirakc
    steps:

    - name: Checkout Repository
      uses: actions/checkout@v4
    
    - name: Create directory
      run: |
        mkdir -p ${HOME}/life-dashboard/mirakc/epgstation/{data/{key,streamfiles},drop,img,thumbnail,logs/{EPGUpdater,Operator,Service},recorded}
    
    - name: start docker images
      env:
        RECREATE_CONTAINER: ${{ inputs.rm_state }}
      run: |
        ./compose.sh
