---

- name: Install Brew packages
  community.general.homebrew:
    name: logrotate
    state: upgraded

- name: Create config directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    recurse: true
    mode: '0755'
  loop:
    - /opt/homebrew/etc/logrotate.d
    - /opt/homebrew/var/lib # for logrotate.status file

- name: Copy config files
  when: not ansible_check_mode
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "/opt/homebrew/etc/logrotate.d/{{ item }}"
    mode: '0644'
  loop:
    - grafana-apply.conf
    - streamlink.conf
    - vlc.conf

- name: Start logrotate
  when: not ansible_check_mode
  community.general.homebrew_services:
    name: logrotate
    state: restarted
