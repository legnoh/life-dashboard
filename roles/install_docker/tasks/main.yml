---

- name: Start Rancher
  block:
    - name: Install/Start Rancher
      ansible.builtin.import_role:
        name: legnoh.dotfiles.install_rancher
      vars:
        install_rancher_memory_in_gb: 8

    - name: Wait dockerd is running
      ansible.builtin.shell: |
        while true
        do
          if {{ ansible_env.HOME }}/.rd/bin/docker ps ps > /dev/null; then
            echo "dockerd is running!"
            exit 0
          fi
          echo "dockerd is starting..."
          sleep 5
        done
      changed_when: false
