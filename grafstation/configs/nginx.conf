http {
  upstream grafana {
    server grafana:3000;
  }

  server {
    listen 80;
    location / {

      if ($http_origin ~* (https?://[^/]*\.yahoo\.co\.jp(:[0-9]+)?)) {
        set $cors "true";
      }
      if ($cors = 'true') {
        add_header  Access-Control-Allow-Origin $http_origin;
        add_header  "Access-Control-Allow-Credentials" "true";
        add_header  "Access-Control-Allow-Methods" "GET, OPTIONS";
        add_header  "Access-Control-Allow-Headers" "Authorization, origin, accept";
      }
      proxy_pass http://grafana;
    }
  }
}
